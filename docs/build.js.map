{"version":3,"file":"build.js","sources":["../src/utils/rng.js","../src/utils/cell.js","../src/utils/rect.js","../src/utils/world.js","../src/utils/fov.js","../src/utils/entity.js","../src/utils/item.js","../src/utils/dungeon.js","../src/utils/colors.js","../src/index.js"],"sourcesContent":["let RNG = create()\nRNG.create = create\n\nexport default RNG\n\nfunction create(initialSeed) {\n\n  if ( isNaN(initialSeed) )\n    initialSeed = Math.random() * 10000\n\n  let currentSeed = initialSeed\n\n  return { get, choose, seed }\n\n  function get(min, max) {\n    var a = arguments.length\n    if (a === 0) {\n      let x = Math.sin(currentSeed++) * 10000\n      return x - Math.floor(x)\n    } else if (a === 1) {\n      if ( !isNaN(min) )\n        max = min, min = 0\n      else if ( Array.isArray(min) )\n        [min, max] = min\n    }\n    if (min > max)\n      [min, max] = [max, min]\n    return Math.floor( get() * (max - min) ) + min\n  }\n\n  function choose(array) {\n    if (Array.isArray(array) && !array.length)\n      return null\n    if ( !isNaN(array) )\n      return !get(array)\n    if (!array)\n      array = [0, 1]\n    return array[ get(array.length) ]\n  }\n\n  function seed(newSeed) {\n    if ( !isNaN(newSeed) )\n      initialSeed = currentSeed = newSeed\n    return currentSeed\n  }\n\n}\n","const DIRECTIONS = [ [-1, 0], [-1, -1], [0, -1], [1, -1], [1, 0], [1, 1], [0, 1], [-1, 1] ]\nconst [LEFT, UP_LEFT, UP, UP_RIGHT, RIGHT, DOWN_RIGHT, DOWN, DOWN_LEFT] = DIRECTIONS\nconst DIRECTIONS_CARDINAL = [LEFT, UP, RIGHT, DOWN]\n\nconst constants = { LEFT, RIGHT, UP, DOWN, UP_LEFT, UP_RIGHT, DOWN_LEFT, DOWN_RIGHT, DIRECTIONS, DIRECTIONS_CARDINAL }\nconst methods   = { toString, fromString, toIndex, fromIndex, isEqual, isEdge, isInside, getNeighbors, getManhattan }\n\nexport default Object.assign(constants, methods)\n\nfunction toString(cell) {\n  return cell.toString()\n}\n\nfunction fromString(string) {\n  return string.split(',').map(Number)\n}\n\nfunction toIndex(cell, size) {\n  let [x, y] = cell\n  return y * size + x\n}\n\nfunction fromIndex(index, size) {\n  let x = index % size\n  let y = (index - x) / size\n  return [x, y]\n}\n\nfunction isEqual(a, b) {\n  return a[0] === b[0] && a[1] === b[1]\n}\n\nfunction isEdge(cell, size) {\n  let [x, y] = cell\n  let rect = [0, 0, size, size]\n  if ( Array.isArray(size) )\n    rect = size\n  let [rectX, rectY, rectWidth, rectHeight] = rect\n  return isInside(cell, size) && (x === rectX || x === rectX + rectWidth - 1 || y === rectY || y === rectY + rectHeight - 1)\n}\n\nfunction isInside(cell, size) {\n  let [x, y] = cell\n  let rect = [0, 0, size, size]\n  if ( Array.isArray(size) )\n    rect = size\n  let [rectX, rectY, rectWidth, rectHeight] = rect\n  return x >= rectX && y >= rectY && x < rectX + rectWidth && y < rectY + rectHeight\n}\n\nfunction getNeighbors(cell, diagonals, step) {\n  if (!cell)\n    throw new TypeError(`Cannot get neighbors of cell '${cell}'`)\n  step = step || 1\n  let [x, y] = cell\n  let neighbors = []\n  let directions = DIRECTIONS_CARDINAL\n  if (diagonals)\n    directions = DIRECTIONS\n  for (let direction of directions) {\n    let [dx, dy] = direction\n    let current  = [x + dx * step, y + dy * step]\n    let [cx, cy] = current\n    neighbors.push( [cx, cy] )\n  }\n  return neighbors\n}\n\nfunction getManhattan(a, b) {\n  var [ax, ay] = a\n  var [bx, by] = b\n  return Math.abs(ax - bx) + Math.abs(ay - by)\n}\n","export default { toString, fromString, isEqual, isIntersecting, getCorners, getEdges, getBorder, getCenter, getCells }\n\nfunction toString(cell) {\n  return cell.toString()\n}\n\nfunction fromString(string) {\n  return string.split(',').map(Number)\n}\n\nfunction isEqual(a, b) {\n  var i = a.length\n  while (i--)\n    if (a[i] !== b[i])\n      return false\n  return true\n}\n\nfunction isIntersecting(a, b, exclusive) {\n  let [ ax, ay, aw, ah ] = a\n  let [ bx, by, bw, bh ] = b\n  if (exclusive)\n    ax--, ay--, aw += 2, ah += 2,\n    bx--, by--, bw += 2, bh += 2\n  return ax <= bx + bw && ay <= by + bh && ax + aw >= bx && ay + ah >= by\n}\n\nfunction getCorners(rect, exclusive) {\n  var [ x, y, w, h ] = rect\n  if (exclusive)\n    x--, y--, w += 2, h += 2\n  return [ [x, y], [x + w - 1, y], [x, y + h - 1], [x + w - 1, y + h - 1] ]\n}\n\nfunction getEdges(rect, exclusive) {\n  var edges = []\n  var [ x, y, w, h ] = rect\n  var r = x + w, b = y + h, i\n  if (exclusive)\n    x--, y--, w += 2, h += 2\n  for (i = x + 1; i < r; i++)\n    edges.push( [ i, y ], [ i, b ] )\n  for (i = y + 1; i < b; i++)\n    edges.push( [ x, i ], [ r, i ] )\n  return edges\n}\n\nfunction getBorder(rect, exclusive) {\n  return getEdges(rect, exclusive).concat( getCorners(rect, exclusive) )\n}\n\nfunction getCenter(rect) {\n  var x, y, w, h\n  if ( Array.isArray(rect) ) {\n    [x, y, w, h] = rect\n    if (rect.length == 2)\n      w = x, h = y, x = 0, y = 0\n  } else if ( !isNaN(rect) )\n    x = 0, y = 0, w = rect, h = rect\n  return [ Math.floor(x + w / 2), Math.floor(y + h / 2) ]\n}\n\nfunction getCells(rect) {\n  var cells = []\n  var [ rectX, rectY, rectWidth, rectHeight ] = rect\n  var i = rectWidth * rectHeight\n  while (i--) {\n    var x = i % rectWidth\n    var y = (i - x) / rectWidth\n    cells[i] = [x + rectX, y + rectY]\n  }\n  return cells\n}\n","import { Cell, Rect } from './index'\n\nconst [FLOOR, WALL, DOOR, DOOR_OPEN, DOOR_SECRET, STAIRS, TRAP] = [0, 1, 2, 3, 4, 5, 6]\nconst tiles = [\n  {\n    name: 'floor',\n    walkable: true\n  },\n  {\n    name: 'wall',\n    opaque: true\n  },\n  {\n    name: 'door',\n    opaque: true,\n    door: true\n  },\n  {\n    name: 'door_open',\n    walkable: true,\n    door: true\n  },\n  {\n    name: 'door_secret',\n    opaque: true,\n    door: true,\n    secret: true\n  },\n  {\n    name: 'stairs',\n    walkable: true,\n    stairs: true\n  },\n  {\n    name: 'trap',\n    walkable: true,\n    trap: true\n  }\n]\n\nlet costs = []\nfor (let tile of tiles) {\n  let cost = 0\n  if (!tile.walkable && !tile.door)\n    cost = Infinity\n  if (tile.secret)\n    cost = 1000\n  if (tile.door) {\n    cost++\n    if (!tile.walkable)\n      cost++\n  }\n  costs.push(cost)\n}\n\nconst constants = { FLOOR, WALL, DOOR, DOOR_OPEN, DOOR_SECRET, STAIRS, TRAP, tiles, costs }\nconst methods   = { create, fill, clear, getAt, getTileAt, setAt, getSize, findPath }\nconst World     = Object.assign({}, constants, methods)\n\nexport default World\n\nlet sqrt = function (cache) {\n\n  cache = cache || {}\n\n  return function sqrt(num) {\n    let cached = cache[num]\n    if (cached)\n      return cached\n    let result = cache[num] = Math.sqrt(num)\n    return result\n  }\n\n}()\n\nfunction create(size) {\n  return new Uint8ClampedArray(size * size)\n}\n\nfunction fill(data, id, rect) {\n  if (typeof id === 'undefined')\n    id = WALL\n  let size = getSize(data)\n  if (rect) {\n    let cells = Rect.getCells(rect)\n    for (let cell of cells)\n      setAt(data, cell, id)\n  } else {\n    let i = data.length\n    while (i--)\n      data[i] = id\n  }\n  return data\n}\n\nfunction clear(data) {\n  fill(data, FLOOR)\n  return data\n}\n\nfunction getAt(data, cell) {\n  let size = getSize(data)\n  if ( !Cell.isInside(cell, size) )\n    return null\n  let index = Cell.toIndex(cell, size)\n  return data[index]\n}\n\nfunction getTileAt(data, cell) {\n  return tiles[ getAt(data, cell) ]\n}\n\nfunction setAt(data, cell, value) {\n  let size = getSize(data)\n  if ( !Cell.isInside(cell, size) )\n    return null\n  let index = Cell.toIndex(cell, size)\n  data[index] = value\n  return value\n}\n\nfunction getSize(data) {\n  return sqrt(data.length)\n}\n\nfunction findPath(data, start, goal, costs, diagonals) {\n\n  if (!costs)\n    costs = {\n      tiles: World.costs,\n      cells: {}\n    }\n\n  if (!costs.tiles)\n    costs = {\n      tiles: costs,\n      cells: {}\n    }\n\n  // if (costs.tiles[ World.getAt(data, goal) ] === Infinity)\n  //   return null\n\n  let path = []\n\n  let size = getSize(data)\n\n  let startKey = start.toString()\n  let goalKey  = goal.toString()\n\n  let opened = [startKey]\n  let closed = {}\n\n  let scores = { f: {}, g: {} }\n  let parent = {}\n\n  let cells = data.reduce( (cells, id, index) => cells.concat( [ Cell.fromIndex(index, size) ] ), [] )\n  for (let cell of cells) {\n    scores.g[cell] = Infinity\n    scores.f[cell] = Infinity\n  }\n\n  scores.g[start] = 0\n  scores.f[start] = Cell.getManhattan(start, goal)\n\n  while (opened.length) {\n    if (opened.length > 1)\n      opened = opened.sort( (a, b) => scores.f[b] - scores.f[a] )\n    let cellKey = opened.pop()\n    let cell = Cell.fromString(cellKey)\n    if (cellKey === goalKey) {\n      let cell = goal\n      do {\n        path.unshift(cell)\n        cell = parent[cell]\n      } while (cell)\n      return path\n    }\n    closed[cell] = true\n    for ( let neighbor of Cell.getNeighbors(cell, diagonals) ) {\n      if (!Cell.isInside(neighbor, size) || neighbor in closed)\n        continue\n      let key = neighbor.toString()\n      let tileCost = costs.tiles[ getAt(data, neighbor) ] || 0\n      let cellCost = costs.cells[neighbor] || 0\n      let cost = tileCost + cellCost\n      if (cost === Infinity && key !== goalKey)\n        continue\n      let g = scores.g[cell] + 1 + cost\n      if ( !opened.includes(key) )\n        opened.push(key)\n      else if ( g >= scores.g[neighbor] )\n        continue\n      parent[neighbor] = cell\n      scores.g[neighbor] = g\n      scores.f[neighbor] = g + Cell.getManhattan(neighbor, goal)\n    }\n  }\n\n  return null\n\n}\n","import { Cell, World } from './index'\n\nexport default { get }\n\nfunction get(data, start, range) {\n  let cells = []\n  let i = 8\n  while (i--)\n    cells = cells.concat( getOctant(data, start, range, i) )\n  cells.push(start)\n  return cells\n}\n\nfunction getOctant(data, start, range, octant) {\n  range = range || Infinity\n  let size = World.getSize(data)\n  let [x, y] = start\n  let cells = []\n  let shadows = []\n  let fullShadow = false\n  for (let row = 1; row <= range; row++) {\n    let [transformX, transformY] = transformOctant(row, 0, octant)\n    let cell = [x + transformX, y + transformY]\n    if ( !Cell.isInside(cell, size) )\n      break\n    for (let col = 0; col <= row; col++) {\n      let [transformX, transformY] = transformOctant(row, col, octant)\n      let cell = [x + transformX, y + transformY]\n      if ( !Cell.isInside(cell, size) || transformX * transformX + transformY * transformY > range * range )\n        break\n      if (!fullShadow) {\n        let projection = getProjection(row, col)\n        let visible = !shadows.find( shadow => shadow.start <= projection.start && shadow.end >= projection.end )\n        if (visible) {\n          cells.push(cell)\n          let id = World.getAt(data, cell)\n          if ( World.tiles[id].opaque ) {\n            let index\n            for (index = 0; index < shadows.length; index++)\n              if (shadows[index].start >= projection.start)\n                break\n            let prev = shadows[index - 1]\n            let next = shadows[index]\n            let overPrev = index > 0 && prev.end > projection.start\n            let overNext = index < shadows.length && next.start < projection.end\n            if (overNext)\n              if (overPrev) {\n                prev.end = next.end\n                shadows.splice(index, 1)\n              } else\n                next.start = projection.start\n            else\n              if (overPrev)\n                prev.end = projection.end\n              else\n                shadows.splice(index, 0, projection)\n            let shadow = shadows[0]\n            fullShadow = shadows.length === 1 && shadow.start === 0 && shadow.end === 1\n          }\n        }\n      }\n    }\n  }\n  return cells\n}\n\nfunction getProjection(row, col) {\n  let start = col / (row + 2)\n  let end   = (col + 1) / (row + 1)\n  return {start, end}\n}\n\nfunction transformOctant(row, col, octant) {\n  switch (octant) {\n    case 0: return [ col, -row]\n    case 1: return [ row, -col]\n    case 2: return [ row,  col]\n    case 3: return [ col,  row]\n    case 4: return [-col,  row]\n    case 5: return [-row,  col]\n    case 6: return [-row, -col]\n    case 7: return [-col, -row]\n  }\n}\n","import { Cell, World, FOV } from './index'\n\nexport default { create }\n\nfunction create(options) {\n\n  let entity = {\n    entityType: null,\n    kind: null\n  }\n\n  let props = {\n    type: 'entity',\n    wandering: true,\n    health: 1,\n    seeing: {},\n    known: {},\n    world: null,\n    cell: null\n  }\n\n  Object.assign(entity, options, props)\n\n  let path = null\n\n  function look() {\n    let cells = FOV.get(entity.world.data, entity.cell, 7)\n    entity.seeing = {}\n    for (var cell of cells) {\n      let kind = World.tiles[ entity.world.getAt(cell) ].name\n      let other = entity.world.elementsAt(cell)[0]\n      if (other)\n        kind = other.kind\n      entity.known[cell] = kind\n      entity.seeing[cell] = true\n    }\n  }\n\n  function move(direction) {\n    let moved = false\n    let world = entity.world\n    let [cellX, cellY] = entity.cell\n    let [distX, distY] = direction\n    let target = [cellX + distX, cellY + distY]\n    let id = world.getAt(target)\n    let tile = World.tiles[id]\n    let entities = world.entitiesAt(target)\n    let items    = world.itemsAt(target)\n    if (entities.length) {\n      let enemy = entities[0]\n      attack(enemy)\n    } else if (tile.walkable) {\n      if (!entities.length) {\n        entity.cell = target\n        world.emit('move', entity, target)\n        if (items.length) {\n          let item = items[0]\n          entity.collect(item)\n        } else {\n          moved = true\n        }\n        look()\n      }\n    } else if (tile.door) {\n      world.openDoor(target, entity)\n      look()\n    }\n    return moved\n  }\n\n  function moveTo(target) {\n    if ( !path || path[path.length - 1] !== target )\n      path = entity.world.findPath(entity, target)\n    if (!path)\n      return false\n    let next\n    path.some(function(cell, index) {\n      if ( !Cell.isEqual(entity.cell, cell) )\n        return\n      next = path[index + 1]\n      return true\n    })\n    if (!next)\n      return false\n    let [cellX, cellY] = entity.cell\n    let [nextX, nextY] = next\n    let dist = [nextX - cellX, nextY - cellY]\n    return entity.move(dist)\n  }\n\n  function attack(other) {\n    other.health--\n    entity.world.emit('attack', entity, other)\n    if (other.health <= 0){\n      entity.world.kill(other)\n      look()\n    }\n  }\n\n  function collect(item) {\n    if ( Cell.isEqual(entity.cell, item.cell) ) {\n      entity.world.kill(item)\n      entity.world.emit('item', entity, item)\n    }\n  }\n\n  let methods = { look, move, moveTo, attack, collect }\n  return Object.assign(entity, methods)\n}\n","export default { create }\n\nfunction create(options) {\n\n  let item = {\n    itemType: null,\n    kind: null,\n    value: null,\n  }\n\n  let props = {\n    type: 'item',\n    world: null,\n    cell: null\n  }\n\n  Object.assign(item, options, props)\n\n  return item\n\n}\n","import { RNG, World, Cell, Rect } from './index'\n\nconst { FLOOR, WALL, DOOR, DOOR_OPEN, DOOR_SECRET, STAIRS, TRAP } = World\n\nlet events = {}\n\nlet rng = RNG.create()\n\nexport default { create }\n\nfunction findRoom(min, max, worldSize) {\n  let w = rng.get((max - min) / 2 + 1) * 2 + min\n  let h = rng.get((max - min) / 2 + 1) * 2 + min\n  let x = rng.get((worldSize - w) / 2) * 2 + 1\n  let y = rng.get((worldSize - h) / 2) * 2 + 1\n  return [x, y, w, h]\n}\n\nlet Diamond = function () {\n\n  let cache = {}\n\n  function cellsFromObject(obj) {\n    return Object.keys(obj).map( key => key.split(',').map(Number) )\n  }\n\n  function cacheDiamond(diamond) {\n\n    let [x, y, radius] = diamond\n\n    let start = [x, y]\n    let stack = [start]\n    let cells = { [start]: 0 }\n    let edges = {}\n    let doors = {}\n\n    while (stack.length) {\n      let node = stack.pop()\n      let nexts = Cell.getNeighbors(node).filter( neighbor => !(neighbor.toString() in cells) )\n      for (let next of nexts) {\n        let steps = cells[node] + 1\n        if (steps <= radius) {\n          cells[next] = steps\n          stack.unshift(next)\n        } else\n          edges[next] = steps\n      }\n    }\n\n    cells = cellsFromObject(cells)\n    edges = cellsFromObject(edges)\n\n    return { cells, edges, center: start }\n\n  }\n\n  function getCached(diamond) {\n    let cached = cache[diamond]\n    if (!cached)\n      cached = cache[diamond] = cacheDiamond(diamond)\n    return cached\n  }\n\n  function getCells(diamond) {\n    return getCached(diamond).cells\n  }\n\n  function getEdges(diamond) {\n    return getCached(diamond).edges\n  }\n\n  function getCenter(diamond) {\n    return getCached(diamond).center\n  }\n\n  return { getCells, getEdges, getCenter }\n\n}()\n\nfunction findDiamondRoom(min, max, worldSize) {\n  let radius = rng.get((max - min) / 2 + 1) * 2 + min\n  let nodes = findNodes(worldSize, radius).map(Cell.fromString)\n  let diamond = rng.choose(nodes)\n  diamond.push(radius)\n  return diamond\n}\n\nfunction findRooms(data, maxRatio) {\n  maxRatio = maxRatio || 0.33\n  let size = World.getSize(data)\n  let area = size * size\n  let valid = true\n  let rooms = { cells: {}, edges: {}, rects: {}, diamonds: {}, normal: new Set, secret: new Set, list: [] }\n  let total = 0\n  let fails = 0\n  let cached = {}\n\n  function validate(cells) {\n    for (let cell of cells)\n      if (rooms.cells[cell] || rooms.edges[cell])\n        return false\n    return true\n  }\n\n  function getData(shape) {\n    switch (shape) {\n      case 'rect': {\n        let matrix = findRoom(3, 9, size)\n        return [matrix, Rect.getBorder(matrix, true)]\n      }\n      case 'diamond': {\n        let matrix = findDiamondRoom(2, 6, size)\n        return [matrix, Diamond.getEdges(matrix)]\n      }\n    }\n  }\n\n  while (valid && total / area < maxRatio) {\n    let shape = 'rect'\n    let matrix\n    do {\n      let cells\n      if ( rng.choose(50) ) {\n        shape = 'diamond'\n      }\n      [matrix, cells] = getData(shape)\n      if (matrix in cached) {\n        valid = false\n        continue\n      }\n      cached[matrix] = valid = validate(cells)\n    } while (!valid && ++fails < area)\n    if (valid) {\n      let edges, room = { edges: {}, shape, matrix, type: 'room' }\n      if (shape === 'rect') {\n        edges = Rect.getBorder(matrix, true)\n        room.cells  = Rect.getCells(matrix)\n        room.center = Rect.getCenter(matrix)\n        rooms.rects[matrix] = room\n      } else if (shape === 'diamond') {\n        edges = Diamond.getEdges(matrix)\n        room.cells  = Diamond.getCells(matrix)\n        room.center = Diamond.getCenter(matrix)\n        rooms.diamonds[matrix] = room\n      }\n      for (let cell of room.cells)\n        rooms.cells[cell] = room\n      for (let edge of edges) {\n        let sharedEdges = room.edges[edge] = rooms.edges[edge] = rooms.edges[edge] || []\n        sharedEdges.push(room)\n      }\n      rooms.normal.add(room)\n      rooms.list.push(room)\n      total += room.cells.length\n    }\n\n  }\n  return rooms\n}\n\nfunction findNodes(worldSize, offset) {\n  offset = offset || 0\n  let data = null\n  if (typeof worldSize === 'object') {\n    data = worldSize\n    worldSize = World.getSize(data)\n  }\n  let nodes = []\n  let half = (worldSize - 1) / 2 - offset\n  let i = half * half\n  while (i--) {\n    let [nodeX, nodeY] = Cell.fromIndex(i, half)\n    let node = [nodeX * 2 + 1 + offset, nodeY * 2 + 1 + offset]\n    if (!data || World.getAt(data, node) === WALL && !Cell.getNeighbors(node, true).filter(neighbor => World.getAt(data, neighbor) !== WALL).length)\n      nodes.push( node.toString() )\n  }\n  return nodes\n}\n\nfunction findMazes(data) {\n  let size = World.getSize(data)\n  let mazes = { cells: {}, ends: {}, list: [] }\n  let nodes = new Set( findNodes(data).map(Cell.toString) )\n  while (nodes.size) {\n    let maze = { cells: {}, ends: {}, type: 'maze' }\n    let start = rng.choose( [...nodes] )\n    let id    = Cell.fromString(start)\n    let stack = [id]\n    let track = [id]\n    let end   = true\n    mazes.ends[start] = maze.ends[start] = maze\n    while (stack.length) {\n      let node, [nodeX, nodeY] = node = stack.pop()\n      nodes.delete( node.toString() )\n      mazes.cells[node] = maze.cells[node] = maze\n      let neighbors = Cell.getNeighbors(node, false, 2).filter(function (neighbor) {\n        if (World.getAt(data, neighbor) !== WALL || neighbor in mazes.cells)\n          return false\n        let nonwalls = Cell.getNeighbors(neighbor, true).filter(neighbor => World.getAt(data, neighbor) !== WALL)\n        return !nonwalls.length\n      })\n      if (neighbors.length) {\n        let neighbor = rng.choose(neighbors)\n        let [neighborX, neighborY] = neighbor\n        let [distX, distY] = [neighborX - nodeX, neighborY - nodeY]\n        let [stepX, stepY] = [ distX / (Math.abs(distX) || 1), distY / (Math.abs(distY) || 1) ]\n        let midpoint = [nodeX + stepX, nodeY + stepY]\n        mazes.cells[midpoint] = maze.cells[midpoint] = maze\n        stack.push(neighbor)\n        track.push(neighbor)\n        end = false\n      } else {\n        if (!end) {\n          mazes.ends[node] = maze.ends[node] = maze\n          end = true\n        }\n        if (track.length)\n          stack.push( track.pop() )\n      }\n    }\n    mazes.list.push(maze)\n  }\n  return mazes\n}\n\nfunction findConnectors(data, rooms, mazes) {\n  let connectors = {}\n  for (let id in rooms.edges) {\n    let cell = Cell.fromString(id)\n    let neighbors = Cell.getNeighbors(cell)\n    let regions = []\n    for (let neighbor of neighbors) {\n      let [x, y] = neighbor\n      if (x % 2 && y % 2 && World.getAt(data, neighbor) === FLOOR) {\n        let region = rooms.cells[neighbor] || mazes.cells[neighbor]\n        if (region)\n          regions.push(region)\n      }\n    }\n    if (regions.length === 2)\n      connectors[cell] = regions\n  }\n  return connectors\n}\n\nfunction findDoors(data, rooms, mazes) {\n\n  let connectorRegions = findConnectors(data, rooms, mazes)\n  let start = rng.choose(rooms.list)\n  let stack = [start]\n  let track = [start]\n  let doorRegions = {}\n\n  let disconnected = new Set(rooms.list)\n  let connected = new Map\n\n  for (let room of rooms.list)\n    room.connections = new Set\n\n  for (let maze of mazes.list)\n    maze.connections = new Set\n\n  while (stack.length) {\n    let node = stack.pop()\n    if ( rooms.list.includes(node) && disconnected.has(node) )\n      disconnected.delete(node)\n    let connectors = getConnectors(node)\n    let connectorKeys = Object.keys(connectors)\n    if (connectorKeys.length) {\n      let connector = rng.choose(connectorKeys)\n      let next = connectors[connector]\n      if (next) {\n        // Remove extraneous connectors\n        for (let id in next.cells) {\n          let cell = Cell.fromString(id)\n          let neighbors = Cell.getNeighbors(cell)\n          for (let neighbor of neighbors) {\n            if ( neighbor in connectorRegions && connectorRegions[neighbor].includes(node) )\n              delete connectorRegions[neighbor]\n          }\n        }\n\n        doorRegions[connector] = [node, next]\n\n        stack.push(next)\n        track.push(next)\n\n        node.connections.add(next)\n        next.connections.add(node)\n      }\n    } else {\n      if (node.type === 'maze' && node.connections.length === 1) {\n        let last = node.connections.entries().next().value\n        last.connections.delete(node)\n        connected.delete(node)\n      }\n      while (track.length) {\n        let next = track.pop()\n        if (next && next !== node) {\n          stack.push(next)\n          track.push(next)\n          // console.log('Backtracking to', next.type)\n          break\n        }\n      }\n    }\n  }\n\n  // for (let connector in connectorRegions)\n  //   World.setAt(data, Cell.fromString(connector), DOOR_OPEN)\n\n  return doorRegions\n\n  // Connectors store the `regions` they connect; get the one that's not `node`\n  function getNext(regions, node) {\n    for (let region of regions)\n      if (region !== node)\n        return region\n    return null\n  }\n\n  // Get the valid connectors of the specified `node`\n  function getConnectors(node) {\n    let connectors = {}\n    let prospects = []\n    // Normalize based on type\n    if (node.type === 'room') {\n      for (let id in node.edges)\n        if (id in connectorRegions)\n          prospects.push(id)\n    } else if (node.type === 'maze') {\n      for (let id in node.cells) {\n        let cell = Cell.fromString(id)\n        let neighbors = Cell.getNeighbors(cell)\n        for (let neighbor of neighbors) {\n          if (neighbor in connectorRegions)\n            prospects.push(neighbor.toString())\n        }\n      }\n    }\n    for (let id of prospects) {\n      let cell = Cell.fromString(id)\n      let regions = connectorRegions[id]\n      let next = getNext(regions, node)\n      if (next) {\n        let lucky = rng.choose(5)\n        let isIncluded  = id in doorRegions\n        let isConnected = node.connections.has(next)\n        let isMain      = connected.has(next) && !lucky\n        let nearby      = !!Cell.getNeighbors(cell, true).filter(neighbor => neighbor in doorRegions).length\n        if (!isIncluded && !isConnected && !isMain && !nearby)\n          connectors[id] = next\n      }\n    }\n    return connectors\n  }\n\n}\n\nfunction fillEnds(data, mazes, doors) {\n  let stack = Object.keys(mazes.ends).map(Cell.fromString)\n  let ends = []\n  while (stack.length) {\n    let cell = stack.pop()\n    let escapes = Cell.getNeighbors(cell).filter( neighbor => World.getTileAt(data, neighbor).walkable || neighbor in doors )\n    if (escapes.length <= 1) {\n      delete mazes.cells[cell]\n      World.setAt(data, cell, WALL)\n      if (escapes.length)\n        stack.push( escapes[0] )\n    } else {\n      ends.push(cell)\n    }\n  }\n  ends = ends.filter(end => World.getAt(data, end) === FLOOR && Cell.getNeighbors(end).filter( neighbor => World.getTileAt(data, neighbor).walkable ).length === 1)\n  return ends\n}\n\nfunction generate(size, seed) {\n\n  let data = World.fill( World.create(size) )\n\n  let rooms = findRooms(data)\n  for (let room of rooms.list)\n    for (let cell of room.cells)\n      World.setAt(data, cell, FLOOR)\n\n  let mazes = findMazes(data)\n  for (let maze of mazes.list)\n    for (let id in maze.cells)\n      World.setAt(data, Cell.fromString(id), FLOOR)\n\n  let doors = findDoors(data, rooms, mazes)\n\n  let ends = fillEnds(data, mazes, doors)\n  let endKeys = ends.map(Cell.toString)\n\n  for (let id in doors) {\n    let cell = Cell.fromString(id)\n    let regions = doors[id]\n    let room = regions.filter(region => region.type !== 'maze')[0]\n    let type = DOOR\n    let neighbors = Cell.getNeighbors(cell).filter( neighbor => endKeys.includes( neighbor.toString() ) )\n    if ( !neighbors.length && rng.choose() ) {\n      type = DOOR_SECRET\n      rooms.normal.delete(room)\n      rooms.secret.add(room)\n    } else if ( rng.choose(5) )\n      type = FLOOR\n    World.setAt(data, cell, type)\n  }\n\n  return {data, rooms}\n\n}\n\nfunction create(size, seed) {\n\n  if (!size % 2)\n    throw new RangeError(`Cannot create dungeon of even size ${size}`)\n\n  if (typeof seed === 'object') {\n    rng = seed\n    seed = rng.seed()\n  } else if ( isNaN(seed) ) {\n    seed = rng.get()\n    rng.seed(seed)\n  }\n\n  console.log('Seed:', seed)\n\n  let {data, rooms} = generate(size, seed)\n\n  function spawn(element, cell) {\n    if (!world.rooms)\n      return null\n    if (typeof cell !== 'object') {\n      let valid\n      do {\n        let room = rng.choose( [...world.rooms.normal] )\n        if (cell !== 'center')\n          cell = rng.choose(room.cells)\n        else\n          cell = room.center\n      } while (elementsAt(cell).length && getAt(cell) === FLOOR)\n    }\n    if ( !isNaN(element) )\n      setAt(cell, element)\n    else if (typeof element === 'object') {\n      element.world = world\n      element.cell  = cell\n      getList(element).push(element)\n    }\n    return cell\n  }\n\n  function getList(element) {\n    switch (element.type) {\n      case 'entity':\n        return world.entities\n      case 'item':\n        return world.items\n      default:\n        return null\n    }\n  }\n\n  function kill(element) {\n    let list = getList(element)\n    if (!list)\n      return false\n    let index = list.indexOf(element)\n    if (index < 0)\n      return false\n    list.splice(index, 1)\n    return true\n  }\n\n  function elementsAt(cell) {\n    return entitiesAt(cell).concat(itemsAt(cell))\n  }\n\n  function entitiesAt(cell) {\n    return world.entities.filter( entity => Cell.isEqual(entity.cell, cell) )\n  }\n\n  function itemsAt(cell) {\n    return world.items.filter(   item => Cell.isEqual(  item.cell, cell) )\n  }\n\n\n  function getAt(cell) {\n    return World.getAt(world.data, cell)\n  }\n\n  function getTileAt(cell) {\n    return World.tiles[ getAt(cell) ]\n  }\n\n  function setAt(cell, value) {\n    return World.setAt(world.data, cell, value)\n  }\n\n  function findPath(start, goal) {\n    let entity = null\n    if (!Array.isArray(start) && typeof start === 'object') {\n      entity = start\n      start = entity.cell\n    }\n    let cells = {}\n    if (!entity) {\n      for (let entity of world.entities)\n        cells[entity.cell] = Infinity\n    } else {\n      let world = entity.world\n      world.data.forEach((id, index) => {\n        let cell = Cell.fromIndex(index, world.size)\n        if ( !entity.known[cell] || world.entitiesAt(cell).filter(entity => !entity.walkable).length )\n          cells[cell] = Infinity\n      })\n    }\n    let costs = { tiles: World.costs, cells }\n    let path = World.findPath(world.data, start, goal, costs)\n    return path\n  }\n\n  function openDoor(cell, entity) {\n    if (!entity)\n      entity = null\n    let data = world.data.slice()\n    let id   = getAt(cell)\n    let tile = World.tiles[id]\n    if (tile.door && !tile.walkable) {\n      World.setAt(data, cell, DOOR_OPEN)\n      world.data = data\n      emit('door-opened', entity, cell, id === DOOR_SECRET)\n      return true\n    }\n    return false\n  }\n\n  function closeDoor(cell, entity) {\n    if (!entity)\n      entity = null\n    let data = world.data.slice()\n    let tile = getTileAt(cell)\n    if (tile.door && tile.walkable) {\n      World.setAt(data, cell, DOOR)\n      world.data = data\n      emit('door-closed', entity, cell)\n      return true\n    }\n    return false\n  }\n\n  function toggleDoor(cell, entity) {\n    let tile = getTileAt(cell)\n    if (tile.door)\n      if (!tile.walkable)\n        return openDoor(cell, entity)\n      else\n        return closeDoor(cell, entity)\n    return false\n  }\n\n  function emit(event) {\n    let args = Array.prototype.slice.call(arguments, 1)\n    let callbacks = events[event]\n    if (!callbacks)\n      return\n    for (let callback of callbacks)\n      callback.apply(null, args)\n  }\n\n  function on(event, callback) {\n    let callbacks = events[event]\n    if (!callbacks)\n      callbacks = events[event] = new Set\n    callbacks.add(callback)\n    return world\n  }\n\n  function off(event, callback) {\n    let callbacks = events[event]\n    if (!callbacks || !callbacks.has(callback))\n      return false\n    callbacks.remove(callback)\n    return true\n  }\n\n  let props   = { size, data, rooms, entities: [], items: [] }\n  let methods = { spawn, kill, elementsAt, entitiesAt, itemsAt, getAt, getTileAt, setAt, findPath, openDoor, closeDoor, toggleDoor, on, emit }\n\n  let world = Object.assign({}, props, methods)\n  return world\n\n}\n","// High-contrast shades\nconst RED     = [255,   0,   0]\nconst YELLOW  = [255, 255,   0]\nconst LIME    = [  0, 255,   0]\nconst CYAN    = [  0, 255, 255]\nconst BLUE    = [  0,   0, 255]\nconst MAGENTA = [255,   0, 255]\n\n// Darker ones\nconst MAROON = [128,   0,   0]\nconst OLIVE  = [128, 128,   0]\nconst GREEN  = [  0, 128,   0]\nconst TEAL   = [  0, 128, 128]\nconst NAVY   = [  0,   0, 128]\nconst PURPLE = [128,   0, 128]\n\n// Monochromes\nconst WHITE = [255, 255, 255]\nconst GRAY  = [128, 128, 128]\nconst BLACK = [  0,   0,   0]\n\nlet lighter = {\n  [MAROON]: RED,\n   [OLIVE]: YELLOW,\n   [GREEN]: LIME,\n    [TEAL]: CYAN,\n    [NAVY]: BLUE,\n  [PURPLE]: MAGENTA,\n    [GRAY]: WHITE,\n   [BLACK]: GRAY\n}\nlet darker  = {\n      [RED]: MAROON,\n   [YELLOW]: OLIVE,\n     [LIME]: GREEN,\n     [CYAN]: TEAL,\n     [BLUE]: NAVY,\n  [MAGENTA]: PURPLE,\n    [WHITE]: GRAY,\n     [GRAY]: BLACK\n}\n\nfunction lighten(color) {\n  return lighter[color]\n}\n\nfunction darken(color) {\n  return darker[color]\n}\n\nconst constants = { RED, YELLOW, LIME, CYAN, BLUE, MAGENTA, MAROON, OLIVE, GREEN, TEAL, NAVY, PURPLE, WHITE, GRAY, BLACK }\nconst methods   = { lighten, darken }\nexport default Object.assign( {}, constants, methods )\n","import { Dungeon, World, Entity, Item, Cell, Rect, RNG, Colors } from './utils/index'\n\nconst DISPLAY_SIZE = 25\nconst WORLD_SIZE = DISPLAY_SIZE\nconst { FLOOR, WALL, DOOR, DOOR_OPEN, DOOR_HIDDEN, STAIRS, TRAP } = World\nconst { RED, MAROON, YELLOW, OLIVE, LIME, GREEN, CYAN, TEAL, BLUE, NAVY, MAGENTA, PURPLE, WHITE, GRAY, BLACK } = Colors\n\nconst sprites = {\n\n  // Tiles\n  floor:       [String.fromCharCode(183), TEAL],\n  wall:        ['#', OLIVE],\n  door:        ['+', MAROON],\n  door_open:   ['/', MAROON],\n  door_secret: ['#', OLIVE],\n  stairs:      ['>', WHITE],\n  trap:        ['^', MAGENTA],\n\n  // Entities\n  human:       ['@', WHITE],\n  wyrm:        ['w', LIME],\n  slime:       ['j', BLUE],\n\n  // Items\n  gold:        ['$', YELLOW],\n  silver:      ['$', WHITE],\n  copper:      ['$', MAROON]\n\n}\n\nlet floors = []\nlet floor  = 1\n\n// Use `RNG.create(seed)` to seed the RNG, where `seed` is some\n// number like `7255.9743678451105`. Seeding the RNG allows you\n// to achieve the same dungeon multiple times for debugging.\n//\n// Leave empty for a random seed.\n//\nconst rng = RNG.create()\n\nconst attacks = ['bash', 'whack', 'mangle', 'tear apart', 'bite']\n\n// TODO: Change these to key/value pairs with data on each enemy\nconst enemies = ['wyrm', 'slime']\nfunction spawnEnemies(world) {\n  let i = 10\n  while (i--) {\n    let kind = rng.choose(enemies)\n    let options = { entityType: 'enemy', kind }\n    let enemy = Entity.create(options)\n    world.spawn(enemy)\n  }\n}\n\nconst money = {\n  copper: {\n    range: [4, 16]\n  },\n  silver: {\n    range: [32, 128],\n    chance: 0.10\n  },\n  gold: {\n    range: [256, 1024],\n    chance: 0.01\n  }\n}\nfunction spawnMoney(world) {\n\n  let i = 10\n\n  while (i--) {\n\n    let num = rng.get(100) + 1\n    let lowest = 1\n    let rarest = null\n    for (let kind in money) {\n      let { range, chance } = money[kind]\n      if (!chance)\n        chance = 1\n      if (chance <= lowest && num <= chance * 100) {\n        lowest = chance\n        rarest = kind\n      }\n    }\n\n    let kind  = rarest\n    let value = rng.get(money[kind].range)\n\n    let options = { itemType: 'money', kind, value }\n    let item = Item.create(options)\n\n    world.spawn(item)\n\n  }\n\n}\n\nfunction generate() {\n  let world = Dungeon.create(WORLD_SIZE, rng)\n  let hero = Entity.create( { entityType: 'hero', kind: 'human' } )\n  world.spawn(hero)\n  world.spawn(STAIRS, 'center')\n  world.spawn(TRAP)\n  spawnEnemies(world)\n  spawnMoney(world)\n  for (let entity of world.entities)\n    entity.look()\n  return {world, hero}\n}\n\nnew Vue({\n  el: '#app',\n  data: function () {\n    let { world, hero } = generate()\n    let log = []\n\n    if (world.rooms.secret.size)\n      log.push('Something feels off about this dungeon...')\n    else\n      log.push(`Oh boy, a dungeon! Let's see what kinds of treasure we can find.`)\n\n    world.on('door-opened', (entity, cell, secret) => {\n      if (entity === hero)\n        if (!secret)\n          log.push('You open the door.')\n        else\n          log.push('You find a secret room!')\n    })\n\n    world.on('move', (entity, cell) => {\n      if (entity === hero)\n        if (world.getAt(cell) === STAIRS)\n          log.push(`There's a set of stairs going down here.`)\n    })\n\n    world.on('attack', (entity, other) => {\n      let attack = rng.choose(attacks)\n      if (entity === hero)\n        log.push(`You ${attack} the ${other.kind}!`)\n    })\n\n    world.on('item', (entity, item) => {\n      if (entity === hero)\n        if (item.itemType === 'money')\n          log.push(`Found ${item.value} gold.`)\n    })\n\n    return { world, hero, log, debug: false }\n  },\n  methods: {\n    onclick: function (target) {\n      let {world, hero, debug, log} = this\n      let cell = hero.cell\n\n      if ( Cell.isEqual(cell, target) ) {\n        if (world.getAt(cell) === STAIRS) {\n          log.push(`You head downstairs.`)\n          this.descend()\n        }\n        return\n      }\n\n      if ( !hero.known[target] && !debug )\n        return\n\n      function move() {\n        let moved = hero.moveTo(target)\n        if (moved)\n          window.requestAnimationFrame(move)\n      }\n      move()\n\n    },\n    ascend: function () {\n\n    },\n    descend: function () {\n      let log = this.log\n      let { world, hero } = generate()\n\n      if (world.rooms.secret.size)\n        log.push('Something feels off about this dungeon...')\n\n      world.on('door-opened', (entity, cell, secret) => {\n        if (entity === hero)\n          if (!secret)\n            log.push('You open the door.')\n          else\n            log.push('You find a secret room!')\n      })\n\n      world.on('move', (entity, cell) => {\n        if (entity === hero)\n          if (world.getAt(cell) === STAIRS)\n            log.push(`There's a set of stairs going down here.`)\n      })\n\n      world.on('attack', (entity, other) => {\n        let attack = rng.choose(attacks)\n        let punctuation = rng.choose( ['.', '!'] )\n        if (entity === hero)\n          log.push(`You ${attack} the ${other.kind}${punctuation}`)\n      })\n\n      world.on('item', (entity, item) => {\n        if (entity === hero)\n          if (item.itemType === 'money')\n            log.push(`Found ${item.value} gold.`)\n      })\n\n      this.world = world\n      this.hero  = hero\n    }\n  },\n  computed: {\n    view: function () {\n      let {world, hero, debug} = this\n      let view = []\n      world.data.forEach((id, index) => {\n        let cell, [cellX, cellY] = cell = Cell.fromIndex(index, WORLD_SIZE)\n        let type = hero.known[cell]\n        let char = ' ', color\n        if (!type && debug)\n          type = world.getTileAt(cell).name\n        if (type) {\n          if ( !(type in sprites) ) {\n            throw new TypeError('Unrecognized sprite: ' + type)\n          }\n          [char, color] = sprites[type]\n          if ( !hero.seeing[cell] )\n            color = GRAY\n          if ( Array.isArray(color) )\n            color = `rgb(${color.join(', ')})`\n        }\n        // Outside brackets = all tiles are appended to the view\n        //  Inside brackets = only tiles that are needed are appended\n        let style = {\n          color,\n          // left: cellX + 'em',\n          // top:  cellY + 'em'\n        }\n        let sprite = { char, style, cell }\n        view.push(sprite)\n      })\n      return view\n    }\n  },\n  mounted: function () {\n    let vue = this\n    vue.$el.style.fontSize = `calc(100vmin / ${WORLD_SIZE})`\n    function handleKeys(event) {\n      let flag = event.type === 'keydown'\n      if (event.code === 'Space' && vue.debug !== flag) {\n        vue.debug = flag\n      }\n    }\n    window.addEventListener('keydown', handleKeys)\n    window.addEventListener('keyup',   handleKeys)\n  },\n  components: {\n    game: {\n      template: '#game-template',\n      props: ['view', 'onclick']\n    },\n    log: {\n      template: '#log-template',\n      props: ['view']\n    }\n  }\n})\n"],"names":["RNG","create","initialSeed","isNaN","Math","random","currentSeed","get","choose","seed","min","max","a","arguments","length","x","sin","floor","Array","isArray","array","newSeed","DIRECTIONS","LEFT","UP_LEFT","UP","UP_RIGHT","RIGHT","DOWN_RIGHT","DOWN","DOWN_LEFT","DIRECTIONS_CARDINAL","constants","methods","toString","fromString","toIndex","fromIndex","isEqual","isEdge","isInside","getNeighbors","getManhattan","Object","assign","cell","string","split","map","Number","size","y","index","b","rect","rectX","rectY","rectWidth","rectHeight","diagonals","step","TypeError","neighbors","directions","direction","dx","dy","current","cx","cy","push","ax","ay","bx","by","abs","isIntersecting","getCorners","getEdges","getBorder","getCenter","getCells","i","exclusive","aw","ah","bw","bh","w","h","edges","r","concat","cells","FLOOR","WALL","DOOR","DOOR_OPEN","DOOR_SECRET","STAIRS","TRAP","tiles","costs","tile","cost","walkable","door","Infinity","secret","fill","clear","getAt","getTileAt","setAt","getSize","findPath","World","sqrt","cache","num","cached","result","Uint8ClampedArray","data","id","Rect","Cell","value","start","goal","path","startKey","goalKey","opened","closed","scores","f","g","parent","reduce","sort","cellKey","pop","unshift","neighbor","key","tileCost","cellCost","includes","range","getOctant","octant","shadows","fullShadow","row","transformOctant","transformX","transformY","col","projection","getProjection","visible","find","shadow","end","opaque","prev","next","overPrev","overNext","splice","options","entity","props","look","FOV","world","seeing","kind","name","other","elementsAt","known","move","moved","cellX","cellY","distX","distY","target","entities","entitiesAt","items","itemsAt","enemy","emit","item","collect","openDoor","moveTo","some","nextX","nextY","dist","attack","health","kill","events","rng","findRoom","worldSize","Diamond","cellsFromObject","obj","keys","cacheDiamond","diamond","radius","stack","doors","node","nexts","filter","steps","center","getCached","findDiamondRoom","nodes","findNodes","findRooms","maxRatio","area","valid","rooms","rects","diamonds","normal","Set","list","total","fails","validate","getData","shape","matrix","room","type","edge","sharedEdges","add","offset","half","nodeX","nodeY","findMazes","mazes","ends","maze","track","delete","nonwalls","neighborX","neighborY","stepX","stepY","midpoint","findConnectors","connectors","regions","region","findDoors","connectorRegions","doorRegions","disconnected","connected","Map","connections","has","getConnectors","connectorKeys","connector","last","entries","getNext","prospects","lucky","isIncluded","isConnected","isMain","nearby","fillEnds","escapes","generate","endKeys","RangeError","log","spawn","element","getList","indexOf","forEach","slice","closeDoor","toggleDoor","event","args","prototype","call","callbacks","callback","apply","on","RED","YELLOW","LIME","CYAN","BLUE","MAGENTA","MAROON","OLIVE","GREEN","TEAL","NAVY","PURPLE","WHITE","GRAY","BLACK","lighter","darker","lighten","color","darken","DISPLAY_SIZE","WORLD_SIZE","Colors","sprites","String","fromCharCode","attacks","enemies","spawnEnemies","entityType","Entity","money","spawnMoney","lowest","rarest","chance","itemType","Item","Dungeon","hero","Vue","debug","descend","window","requestAnimationFrame","punctuation","view","char","join","style","sprite","vue","$el","fontSize","handleKeys","flag","code","addEventListener"],"mappings":"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"}